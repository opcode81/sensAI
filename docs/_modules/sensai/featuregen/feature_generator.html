

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>sensai.featuregen.feature_generator &#8212; sensAI Documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/sphinx-toolbox.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/js/vega@5.js"></script>
    <script src="../../../_static/js/vega-lite@5.js"></script>
    <script src="../../../_static/js/vega-embed@5.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/sensai/featuregen/feature_generator';</script>
    <link rel="canonical" href="https://tianshou.readthedocs.io/en/master/_modules/sensai/featuregen/feature_generator.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/sensai-logo.png" class="logo__image only-light" alt="sensAI Documentation - Home"/>
    <script>document.write(`<img src="../../../_static/sensai-logo.png" class="logo__image only-dark" alt="sensAI Documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    Welcome to sensAI!
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../1-supervised-learning/1-vector-models.html">Models with Modular Data Pipelines</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../2-notebooks/0_intro.html">Notebook Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../2-notebooks/1-classification.html">Introduction to sensAI: Supervised Learning with VectorModels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../2-notebooks/2-neural_networks.html">Neural Networks</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../sensai/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../sensai/catboost.html">catboost</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sensai/columngen.html">columngen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sensai/distance_metric.html">distance_metric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sensai/feature_importance.html">feature_importance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sensai/hyperopt.html">hyperopt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sensai/lightgbm.html">lightgbm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sensai/local_search.html">local_search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sensai/minizinc.html">minizinc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sensai/multi_model.html">multi_model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sensai/naive_bayes.html">naive_bayes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sensai/nearest_neighbors.html">nearest_neighbors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sensai/normalisation.html">normalisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sensai/sklearn_quantile.html">sklearn_quantile</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sensai/tensor_model.html">tensor_model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sensai/vector_model.html">vector_model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sensai/vectoriser.html">vectoriser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sensai/xgboost.html">xgboost</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../sensai/clustering/index.html">clustering</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/clustering/clustering_base.html">clustering_base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/clustering/greedy_clustering.html">greedy_clustering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/clustering/sklearn_clustering.html">sklearn_clustering</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../sensai/data/index.html">data</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/data/dataset.html">dataset</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/data/io_data.html">io_data</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../sensai/data_transformation/index.html">data_transformation</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/data_transformation/dft.html">dft</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/data_transformation/sklearn_transformer.html">sklearn_transformer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/data_transformation/value_transformation.html">value_transformation</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../sensai/ensemble/index.html">ensemble</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/ensemble/ensemble_base.html">ensemble_base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/ensemble/models.html">models</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../sensai/evaluation/index.html">evaluation</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/evaluation/crossval.html">crossval</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/evaluation/eval_util.html">eval_util</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/evaluation/evaluator.html">evaluator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/evaluation/evaluator_clustering.html">evaluator_clustering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/evaluation/metric_computation.html">metric_computation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/evaluation/result_set.html">result_set</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../sensai/evaluation/eval_stats/index.html">eval_stats</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../sensai/evaluation/eval_stats/eval_stats_base.html">eval_stats_base</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../sensai/evaluation/eval_stats/eval_stats_classification.html">eval_stats_classification</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../sensai/evaluation/eval_stats/eval_stats_clustering.html">eval_stats_clustering</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../sensai/evaluation/eval_stats/eval_stats_regression.html">eval_stats_regression</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../sensai/feature_selection/index.html">feature_selection</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/feature_selection/rfe.html">rfe</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../sensai/featuregen/index.html">featuregen</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/featuregen/feature_generator.html">feature_generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/featuregen/feature_generator_registry.html">feature_generator_registry</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../sensai/geoanalytics/index.html">geoanalytics</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/geoanalytics/geo_clustering.html">geo_clustering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/geoanalytics/geo_coords.html">geo_coords</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/geoanalytics/local_coords.html">local_coords</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/geoanalytics/map_tiles.html">map_tiles</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../sensai/geoanalytics/geopandas/index.html">geopandas</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../sensai/geoanalytics/geopandas/coordinate_clustering.html">coordinate_clustering</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../sensai/geoanalytics/geopandas/coordinate_clustering_ground_truth.html">coordinate_clustering_ground_truth</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../sensai/geoanalytics/geopandas/coordinates.html">coordinates</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../sensai/geoanalytics/geopandas/geometry.html">geometry</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../sensai/geoanalytics/geopandas/graph.html">graph</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../sensai/pytorch_lightning/index.html">pytorch_lightning</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/pytorch_lightning/pl_models.html">pl_models</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../sensai/sklearn/index.html">sklearn</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/sklearn/sklearn_base.html">sklearn_base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/sklearn/sklearn_classification.html">sklearn_classification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/sklearn/sklearn_regression.html">sklearn_regression</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../sensai/tensorflow/index.html">tensorflow</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/tensorflow/tf_base.html">tf_base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/tensorflow/tf_mlp.html">tf_mlp</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../sensai/torch/index.html">torch</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/torch/torch_base.html">torch_base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/torch/torch_data.html">torch_data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/torch/torch_enums.html">torch_enums</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/torch/torch_eval_util.html">torch_eval_util</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/torch/torch_modules.html">torch_modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/torch/torch_opt.html">torch_opt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/torch/torchtext.html">torchtext</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../sensai/torch/torch_models/index.html">torch_models</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../sensai/torch/torch_models/lstnet/index.html">lstnet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../sensai/torch/torch_models/mlp/index.html">mlp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../sensai/torch/torch_models/residualffn/index.html">residualffn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../sensai/torch/torch_models/seq/index.html">seq</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../sensai/tracking/index.html">tracking</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-18"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/tracking/azure_tracking.html">azure_tracking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/tracking/clearml_tracking.html">clearml_tracking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/tracking/mlflow_tracking.html">mlflow_tracking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/tracking/tracking_base.html">tracking_base</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../sensai/util/index.html">util</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-19"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/aggregation.html">aggregation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/cache.html">cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/cache_azure.html">cache_azure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/cache_mysql.html">cache_mysql</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/datastruct.html">datastruct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/deprecation.html">deprecation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/dtype.html">dtype</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/hash.html">hash</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/helper.html">helper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/io.html">io</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/jscode.html">jscode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/logging.html">logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/math.html">math</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/multiprocessing.html">multiprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/pandas.html">pandas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/pickle.html">pickle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/plot.html">plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/profiling.html">profiling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/sequences.html">sequences</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/string.html">string</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/test.html">test</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/time.html">time</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/typing.html">typing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensai/util/version.html">version</a></li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">



<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for sensai.featuregen.feature_generator</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Optional</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">util</span><span class="p">,</span> <span class="n">data_transformation</span>
<span class="kn">from</span> <span class="nn">..data_transformation</span> <span class="kn">import</span> <span class="n">DFTNormalisation</span><span class="p">,</span> <span class="n">DFTFromFeatureGenerator</span><span class="p">,</span> <span class="n">DataFrameTransformer</span>
<span class="kn">from</span> <span class="nn">..util</span> <span class="kn">import</span> <span class="n">flatten_arguments</span>
<span class="kn">from</span> <span class="nn">..util.string</span> <span class="kn">import</span> <span class="n">or_regex_group</span><span class="p">,</span> <span class="n">ToStringMixin</span><span class="p">,</span> <span class="n">list_string</span>
<span class="kn">from</span> <span class="nn">..util.typing</span> <span class="kn">import</span> <span class="n">PandasNamedTuple</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">..vector_model</span> <span class="kn">import</span> <span class="n">VectorModel</span>
    <span class="kn">from</span> <span class="nn">..columngen</span> <span class="kn">import</span> <span class="n">ColumnGenerator</span>


<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="DuplicateColumnNamesException"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.DuplicateColumnNamesException">[docs]</a><span class="k">class</span> <span class="nc">DuplicateColumnNamesException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="FeatureGenerator"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGenerator">[docs]</a><span class="k">class</span> <span class="nc">FeatureGenerator</span><span class="p">(</span><span class="n">ToStringMixin</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for feature generators that create a new DataFrame containing feature values</span>
<span class="sd">    from an input DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">categorical_feature_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">normalisation_rules</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">Rule</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">normalisation_rule_template</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">RuleTemplate</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">add_categorical_default_rules</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param categorical_feature_names: either a sequence of column names or a regex that is to match all categorical feature names</span>
<span class="sd">            (which must not only work for the feature generated by this feature generator, i.e. it should not match feature names generated</span>
<span class="sd">            by other feature generators).</span>
<span class="sd">            It will be ensured that the respective columns in the generated data frames will have dtype &#39;category&#39;.</span>
<span class="sd">            Furthermore, the presence of meta-information can later be leveraged for further transformations, e.g., one-hot encoding.</span>
<span class="sd">        :param normalisation_rules: Rules to be used by DFTNormalisation (e.g.,for constructing an input transformer for a model).</span>
<span class="sd">            These rules are only relevant if a DFTNormalisation object consuming them is instantiated and used</span>
<span class="sd">            within a data processing pipeline. They do not affect feature generation.</span>
<span class="sd">        :param normalisation_rule_template: This parameter can be supplied instead of `normalisation_rules` for the case where</span>
<span class="sd">            there shall be a single rule that applies to all columns generated by this feature generator that were not labeled as</span>
<span class="sd">            categorical. Like normalisation_rules, this is only relevant if a DFTNormalisation object consuming</span>
<span class="sd">            normalisation rules is instantiated and used within a data processing pipeline.</span>
<span class="sd">            It does not affect feature generation.</span>
<span class="sd">        :param add_categorical_default_rules:</span>
<span class="sd">            If True, normalisation rules for categorical features (which are unsupported by normalisation) and their corresponding one-hot</span>
<span class="sd">            encoded features (with &quot;_&lt;index&gt;&quot; appended) will be added. It does not affect feature generation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># NOTE: While it would be more elegant to not have all of the above constructor arguments and instead provide</span>
        <span class="c1"># them later using &quot;with*&quot; methods, this would have the significant drawback that it would enable</span>
        <span class="c1"># all such attributes to be provided in all subclasses, even in ones where we know settings exactly</span>
        <span class="c1"># and can provide them directly in the subclass constructor implementation. Thus it would enable</span>
        <span class="c1"># non-sensical settings which should be avoided.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">normalisation_rules</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">normalisation_rule_template</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Normalisation rules should be empty when a rule template is provided&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_generatedColumnNames</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__categoricalFeatureNames</span> <span class="o">=</span> <span class="n">categorical_feature_names</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">categorical_feature_names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">categorical_feature_name_regex</span> <span class="o">=</span> <span class="n">categorical_feature_names</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">categorical_feature_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">categorical_feature_names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">categorical_feature_name_regex</span> <span class="o">=</span> <span class="n">or_regex_group</span><span class="p">(</span><span class="n">categorical_feature_names</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">categorical_feature_name_regex</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_categoricalFeatureNameRegex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">categorical_feature_name_regex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_categoricalFeatureRules</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">normalisation_rule_template</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Note: placeholder rule&#39;s regex will be set in generate</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_normalisationRules</span> <span class="o">=</span> <span class="p">[</span><span class="n">normalisation_rule_template</span><span class="o">.</span><span class="n">to_placeholder_rule</span><span class="p">()]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mustUpdateNormalisationRuleBasedOnColumnNames</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_normalisationRules</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">normalisation_rules</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mustUpdateNormalisationRuleBasedOnColumnNames</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">add_categorical_default_rules</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">categorical_feature_name_regex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_categoricalFeatureRules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">Rule</span><span class="p">(</span><span class="n">categorical_feature_name_regex</span><span class="p">,</span>
                    <span class="n">unsupported</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_categoricalFeatureRules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">Rule</span><span class="p">(</span><span class="n">categorical_feature_name_regex</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;_\d+&quot;</span><span class="p">,</span>
                    <span class="n">skip</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>  <span class="c1"># rule for one-hot transformation</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isFitted</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># for backwards compatibility with persisted Featuregens based on code prior to commit 7088cbbe</span>
    <span class="c1"># They lack the __isFitted attribute and we assume that each such Featuregen was fitted</span>
    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;_isFitted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_isFitted&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">_tostring_exclude_private</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_tostring_additional_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>

<div class="viewcode-block" id="FeatureGenerator.get_name"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGenerator.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: the name of this feature generator, which may be a default name if the name has not been set. Note that feature generators</span>
<span class="sd">            created by a FeatureGeneratorFactory always get the name with which the generator factory was registered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span></div>

<div class="viewcode-block" id="FeatureGenerator.set_name"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGenerator.set_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span></div>

<div class="viewcode-block" id="FeatureGenerator.get_names"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGenerator.get_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: the list of names of feature generators; will be a list with a single name for a regular feature generator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span></div>

<div class="viewcode-block" id="FeatureGenerator.info"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGenerator.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span>
            <span class="s2">&quot;categoricalFeatureNames&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__categoricalFeatureNames</span><span class="p">,</span>
            <span class="s2">&quot;generatedColumnNames&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_generated_column_names</span><span class="p">(),</span>
            <span class="s2">&quot;isFitted&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fitted</span><span class="p">(),</span>
            <span class="s2">&quot;normalisationRules&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_normalisation_rules</span><span class="p">(),</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="FeatureGenerator.get_normalisation_rules"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGenerator.get_normalisation_rules">[docs]</a>    <span class="k">def</span> <span class="nf">get_normalisation_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_generated_categorical_rules</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">Rule</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">include_generated_categorical_rules</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalisationRules</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_categoricalFeatureRules</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalisationRules</span></div>

<div class="viewcode-block" id="FeatureGenerator.get_categorical_feature_name_regex"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGenerator.get_categorical_feature_name_regex">[docs]</a>    <span class="k">def</span> <span class="nf">get_categorical_feature_name_regex</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_categoricalFeatureNameRegex</span></div>

<div class="viewcode-block" id="FeatureGenerator.is_categorical_feature"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGenerator.is_categorical_feature">[docs]</a>    <span class="k">def</span> <span class="nf">is_categorical_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_categoricalFeatureNameRegex</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_categoricalFeatureNameRegex</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FeatureGenerator.get_generated_column_names"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGenerator.get_generated_column_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_generated_column_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: Column names of the data frame generated by the most recent call of the feature generators &#39;generate&#39; method.</span>
<span class="sd">            Returns None if generate was never called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generatedColumnNames</span></div>

<div class="viewcode-block" id="FeatureGenerator.to_dft"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGenerator.to_dft">[docs]</a>    <span class="k">def</span> <span class="nf">to_dft</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DFTFromFeatureGenerator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits the feature generator based on the given data</span>

<span class="sd">        :param x: the input/features data frame for the learning problem</span>
<span class="sd">        :param y: the corresponding output data frame for the learning problem</span>
<span class="sd">            (which will typically contain regression or classification target columns)</span>
<span class="sd">        :param ctx: a context object whose functionality may be required for feature generation;</span>
<span class="sd">            this is typically the model instance that this feature generator is to generate inputs for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="FeatureGenerator.fit"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGenerator.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits the feature generator based on the given data</span>

<span class="sd">        :param x: the input/features data frame for the learning problem</span>
<span class="sd">        :param y: the corresponding output data frame for the learning problem</span>
<span class="sd">            (which will typically contain regression or classification target columns)</span>
<span class="sd">        :param ctx: a context object whose functionality may be required for feature generation;</span>
<span class="sd">            this is typically the model instance that this feature generator is to generate inputs for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fitting </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isFitted</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="FeatureGenerator.is_fitted"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGenerator.is_fitted">[docs]</a>    <span class="k">def</span> <span class="nf">is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isFitted</span></div>

<div class="viewcode-block" id="FeatureGenerator.generate"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGenerator.generate">[docs]</a>    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates features for the data points in the given data frame</span>

<span class="sd">        :param df: the input data frame for which to generate features</span>
<span class="sd">        :param ctx: a context object whose functionality may be required for feature generation;</span>
<span class="sd">            this is typically the model instance that this feature generator is to generate inputs for</span>
<span class="sd">        :return: a data frame containing the generated features, which uses the same index as X (and Y)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_fitted</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot generate features from a FeatureGenerator which is not fitted: &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;the feature generator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span><span class="si">}</span><span class="s2"> requires fitting&quot;</span><span class="p">)</span>

        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating features with </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">result_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">)</span>

        <span class="n">is_column_duplicated_array</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">is_column_duplicated_array</span><span class="p">):</span>
            <span class="n">duplicated_columns</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">result_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">is_column_duplicated_array</span><span class="p">])</span>
            <span class="k">raise</span> <span class="n">DuplicateColumnNamesException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Feature data frame contains duplicate column names: </span><span class="si">{</span><span class="n">duplicated_columns</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># ensure that categorical columns have dtype &#39;category&#39;</span>
        <span class="n">categorical_feature_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_categoricalFeatureNameRegex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result_df</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># result_df we got might be a view of some other DF, so before we modify it, we must copy it</span>
            <span class="n">categorical_feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">result_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_categorical_feature</span><span class="p">(</span><span class="n">col</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">colName</span> <span class="ow">in</span> <span class="n">categorical_feature_names</span><span class="p">:</span>
                <span class="n">series</span> <span class="o">=</span> <span class="n">result_df</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">series</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;category&#39;</span><span class="p">:</span>
                    <span class="n">result_df</span><span class="p">[</span><span class="n">colName</span><span class="p">]</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_generatedColumnNames</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">columns</span>

        <span class="c1"># finalise normalisation rule template (if any) by making it apply to all non-categorical features</span>
        <span class="c1"># (a default rule applies to categorical features)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mustUpdateNormalisationRuleBasedOnColumnNames</span><span class="p">:</span>
            <span class="n">non_categorical_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generatedColumnNames</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">categorical_feature_names</span><span class="p">))</span>
            <span class="c1"># NOTE: We here update the existing rule which was instantiated with a dummy regex because</span>
            <span class="c1"># some mechanisms (e.g. MultiFeatureGenerators) retrieve rule instances early on (before generate</span>
            <span class="c1"># is ever called) and therefore updating an existing rule is the safe route and should always</span>
            <span class="c1"># work, because rules should never actually be applied before generate has indeed been called</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_normalisationRules</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_regex</span><span class="p">(</span><span class="n">or_regex_group</span><span class="p">(</span><span class="n">non_categorical_features</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mustUpdateNormalisationRuleBasedOnColumnNames</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">result_df</span></div>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates features for the data points in the given data frame.</span>

<span class="sd">        :param df: the input data frame for which to generate features</span>
<span class="sd">        :param ctx: a context object whose functionality may be required for feature generation;</span>
<span class="sd">            this is typically the model instance that this feature generator is to generate inputs for</span>
<span class="sd">        :return: a data frame containing the generated features, which uses the same index as ``df``.</span>
<span class="sd">            The data frame&#39;s columns holding categorical columns are not required to have dtype ``category``;</span>
<span class="sd">            this will be ensured by the encapsulating call as long as the respective columns&#39; names</span>
<span class="sd">            were appropriately provided at construction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="FeatureGenerator.fit_generate"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGenerator.fit_generate">[docs]</a>    <span class="k">def</span> <span class="nf">fit_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits the feature generator and subsequently generates features for the data points in the given data frame</span>

<span class="sd">        :param x: the input data frame for the learning problem and for which to generate features</span>
<span class="sd">        :param y: the corresponding output data frame for the learning problem</span>
<span class="sd">            (which will typically contain regression or classification target columns)</span>
<span class="sd">        :param ctx: a context object whose functionality may be required for feature generation;</span>
<span class="sd">            this is typically the model instance that this feature generator is to generate inputs for</span>
<span class="sd">        :return: a data frame containing the generated features, which uses the same index as X (and Y)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureGenerator.flattened"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGenerator.flattened">[docs]</a>    <span class="k">def</span> <span class="nf">flattened</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">columns_to_flatten</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">normalisation_rules</span><span class="o">=</span><span class="p">(),</span>
            <span class="n">normalisation_rule_template</span><span class="p">:</span> <span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">RuleTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">keep_other_columns</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChainedFeatureGenerator&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a new feature generator which returns flattened versions of one or more of the vector-valued columns generated</span>
<span class="sd">        by this feature generator.</span>

<span class="sd">        :param columns_to_flatten: the list of columns to flatten; if None, flatten all columns</span>
<span class="sd">        :param normalisation_rules: a list of normalisation rules which apply to the flattened columns</span>
<span class="sd">        :param normalisation_rule_template: a normalisation rule template which applies to all generated flattened columns</span>
<span class="sd">        :param keep_other_columns: if True, any additional columns that are not to be flattened are to be retained</span>
<span class="sd">            by the returned feature generator; if False, additional columns are to be discarded</span>
<span class="sd">        :return: a feature generator which generates the flattened columns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">flattened_feature_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns_to_flatten</span><span class="o">=</span><span class="n">columns_to_flatten</span><span class="p">,</span> <span class="n">normalisation_rules</span><span class="o">=</span><span class="n">normalisation_rules</span><span class="p">,</span>
            <span class="n">keep_other_columns</span><span class="o">=</span><span class="n">keep_other_columns</span><span class="p">,</span> <span class="n">normalisation_rule_template</span><span class="o">=</span><span class="n">normalisation_rule_template</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureGenerator.concat"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGenerator.concat">[docs]</a>    <span class="k">def</span> <span class="nf">concat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span><span class="p">:</span> <span class="s2">&quot;FeatureGenerator&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MultiFeatureGenerator&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Concatenates this feature generator with one or more other feature generator in order to produce a feature generator that</span>
<span class="sd">        jointly generates all features</span>

<span class="sd">        :param others: other feature generators</span>
<span class="sd">        :return: a :class:`MultiFeatureGenerator`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MultiFeatureGenerator</span><span class="p">):</span>
            <span class="n">fgens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featureGenerators</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fgens</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
        <span class="n">fgens</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">others</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MultiFeatureGenerator</span><span class="p">(</span><span class="n">fgens</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureGenerator.chain"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGenerator.chain">[docs]</a>    <span class="k">def</span> <span class="nf">chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span><span class="p">:</span> <span class="s2">&quot;FeatureGenerator&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChainedFeatureGenerator&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Chains this feature generator with one or more other feature generators such that each feature generator</span>
<span class="sd">        receives as input the output of the preceding feature generator. The resulting feature generator</span>
<span class="sd">        produces the features of the last element in the chain.</span>

<span class="sd">        :param others: other feature generator</span>
<span class="sd">        :return: a :class:`ChainedFeatureGenerator`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ChainedFeatureGenerator</span><span class="p">):</span>
            <span class="n">fgens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureGenerators</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fgens</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
        <span class="n">fgens</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">others</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ChainedFeatureGenerator</span><span class="p">(</span><span class="n">fgens</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="RuleBasedFeatureGenerator"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.RuleBasedFeatureGenerator">[docs]</a><span class="k">class</span> <span class="nc">RuleBasedFeatureGenerator</span><span class="p">(</span><span class="n">FeatureGenerator</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A feature generator which does not require fitting</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="RuleBasedFeatureGenerator.fit"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.RuleBasedFeatureGenerator.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">pass</span></div>

    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="RuleBasedFeatureGenerator.is_fitted"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.RuleBasedFeatureGenerator.is_fitted">[docs]</a>    <span class="k">def</span> <span class="nf">is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="MultiFeatureGenerator"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.MultiFeatureGenerator">[docs]</a><span class="k">class</span> <span class="nc">MultiFeatureGenerator</span><span class="p">(</span><span class="n">FeatureGenerator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper for multiple feature generators. Calling generate here applies all given feature generators independently and</span>
<span class="sd">    returns the concatenation of their outputs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">feature_generators</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">FeatureGenerator</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FeatureGenerator</span><span class="p">]]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featureGenerators</span> <span class="o">=</span> <span class="n">feature_generators</span> <span class="o">=</span> <span class="n">flatten_arguments</span><span class="p">(</span><span class="n">feature_generators</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featureGenerators</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Creating an empty MultiFeatureGenerator. It will generate a data frame without columns.&quot;</span><span class="p">)</span>
        <span class="n">categorical_feature_name_regexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">regex</span> <span class="k">for</span> <span class="n">regex</span> <span class="ow">in</span> <span class="p">[</span><span class="n">fg</span><span class="o">.</span><span class="n">get_categorical_feature_name_regex</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">fg</span> <span class="ow">in</span> <span class="n">feature_generators</span><span class="p">]</span> <span class="k">if</span> <span class="n">regex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">categorical_feature_name_regexes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">categorical_feature_names</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">categorical_feature_name_regexes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">categorical_feature_names</span> <span class="o">=</span> <span class="p">()</span>
        <span class="n">normalisation_rules</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">concat_sequences</span><span class="p">([</span><span class="n">fg</span><span class="o">.</span><span class="n">get_normalisation_rules</span><span class="p">()</span> <span class="k">for</span> <span class="n">fg</span> <span class="ow">in</span> <span class="n">feature_generators</span><span class="p">])</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">categorical_feature_names</span><span class="o">=</span><span class="n">categorical_feature_names</span><span class="p">,</span> <span class="n">normalisation_rules</span><span class="o">=</span><span class="n">normalisation_rules</span><span class="p">,</span>
            <span class="n">add_categorical_default_rules</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_tostring_object_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;featureGenerators=</span><span class="si">{</span><span class="n">list_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">featureGenerators</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">_generate_from_multiple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generate_features</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">FeatureGenerator</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">index</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureGenerators</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">generate_features</span><span class="p">(</span><span class="n">fg</span><span class="p">)</span>
            <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">combined_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">combined_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">combined_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;At least one column was generated more than once: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">combined_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">; &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;check feature generators for correctness!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">combined_df</span>

    <span class="k">def</span> <span class="nf">_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">generate_features</span><span class="p">(</span><span class="n">fg</span><span class="p">:</span> <span class="n">FeatureGenerator</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">fg</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">input_df</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_from_multiple</span><span class="p">(</span><span class="n">generate_features</span><span class="p">,</span> <span class="n">input_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<div class="viewcode-block" id="MultiFeatureGenerator.fit_generate"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.MultiFeatureGenerator.fit_generate">[docs]</a>    <span class="k">def</span> <span class="nf">fit_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fitting and generating features with </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">generate_features</span><span class="p">(</span><span class="n">fg</span><span class="p">:</span> <span class="n">FeatureGenerator</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">fg</span><span class="o">.</span><span class="n">fit_generate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_from_multiple</span><span class="p">(</span><span class="n">generate_features</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureGenerators</span><span class="p">:</span>
            <span class="n">fg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<div class="viewcode-block" id="MultiFeatureGenerator.is_fitted"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.MultiFeatureGenerator.is_fitted">[docs]</a>    <span class="k">def</span> <span class="nf">is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="n">fg</span><span class="o">.</span><span class="n">is_fitted</span><span class="p">()</span> <span class="k">for</span> <span class="n">fg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureGenerators</span><span class="p">])</span></div>

<div class="viewcode-block" id="MultiFeatureGenerator.info"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.MultiFeatureGenerator.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">MultiFeatureGenerator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;featureGeneratorNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_names</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">info</span></div>

<div class="viewcode-block" id="MultiFeatureGenerator.get_names"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.MultiFeatureGenerator.get_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="p">[</span><span class="n">fg</span><span class="o">.</span><span class="n">get_names</span><span class="p">()</span> <span class="k">for</span> <span class="n">fg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureGenerators</span><span class="p">],</span> <span class="p">[])</span></div></div>


<div class="viewcode-block" id="FeatureGeneratorFromNamedTuples"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGeneratorFromNamedTuples">[docs]</a><span class="k">class</span> <span class="nc">FeatureGeneratorFromNamedTuples</span><span class="p">(</span><span class="n">FeatureGenerator</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates feature values for one data point at a time, creating a dictionary with</span>
<span class="sd">    feature values from each named tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">KeyValueCache</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">categorical_feature_names</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
                 <span class="n">normalisation_rules</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">Rule</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
                 <span class="n">normalisation_rule_template</span><span class="p">:</span> <span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">RuleTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">categorical_feature_names</span><span class="o">=</span><span class="n">categorical_feature_names</span><span class="p">,</span> <span class="n">normalisation_rules</span><span class="o">=</span><span class="n">normalisation_rules</span><span class="p">,</span>
            <span class="n">normalisation_rule_template</span><span class="o">=</span><span class="n">normalisation_rule_template</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="n">cache</span>

    <span class="k">def</span> <span class="nf">_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">dicts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">nt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">itertuples</span><span class="p">()):</span>
            <span class="n">nt</span><span class="p">:</span> <span class="n">PandasNamedTuple</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating feature via </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> for index </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">nt</span><span class="o">.</span><span class="n">Index</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_feature_dict</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">nt</span><span class="o">.</span><span class="n">Index</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="n">dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dicts</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_generate_feature_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">named_tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a dictionary with feature values from a named tuple</span>

<span class="sd">        :param named_tuple: the data point for which to generate features</span>
<span class="sd">        :return: a dictionary mapping feature names to values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="FeatureGeneratorTakeColumns"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGeneratorTakeColumns">[docs]</a><span class="k">class</span> <span class="nc">FeatureGeneratorTakeColumns</span><span class="p">(</span><span class="n">RuleBasedFeatureGenerator</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">except_columns</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">categorical_feature_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">normalisation_rules</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">Rule</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">normalisation_rule_template</span><span class="p">:</span> <span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">RuleTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">verify_column_names</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param columns: name of the column or list of names of columns to be taken. If None, all columns will be taken.</span>
<span class="sd">        :param except_columns: list of names of columns to not take if present in the input df</span>
<span class="sd">        :param categorical_feature_names: either a sequence of column names or a regex that is to match all categorical feature names</span>
<span class="sd">            (which must not only work for the feature generated by this feature generator, i.e. it should not match feature names generated</span>
<span class="sd">            by other feature generators).</span>
<span class="sd">            It will be ensured that the respective columns in the generated data frames will have dtype &#39;category&#39;.</span>
<span class="sd">            Furthermore, presence of meta-information can later be leveraged for further transformations, e.g. one-hot encoding.</span>
<span class="sd">        :param normalisation_rules: Rules to be used by DFTNormalisation (e.g. for constructing an input transformer for a model).</span>
<span class="sd">            These rules are only relevant if a DFTNormalisation object consuming them is instantiated and used</span>
<span class="sd">            within a data processing pipeline. They do not affect feature generation.</span>
<span class="sd">        :param normalisation_rule_template: This parameter can be supplied instead of normalisationRules for the case where</span>
<span class="sd">            there shall be a single rule that applies to all columns generated by this feature generator that were not labeled as</span>
<span class="sd">            categorical.</span>
<span class="sd">        :param verify_column_names: if True and columns to take were specified, will raise an error in case said columns</span>
<span class="sd">            are missing during feature generation. If False, will log on info level instead</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">categorical_feature_names</span><span class="o">=</span><span class="n">categorical_feature_names</span><span class="p">,</span> <span class="n">normalisation_rules</span><span class="o">=</span><span class="n">normalisation_rules</span><span class="p">,</span>
            <span class="n">normalisation_rule_template</span><span class="o">=</span><span class="n">normalisation_rule_template</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">columns</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exceptColumns</span> <span class="o">=</span> <span class="n">except_columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verifyColumnNames</span> <span class="o">=</span> <span class="n">verify_column_names</span>

    <span class="k">def</span> <span class="nf">_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">columns_to_take</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">columns_to_take</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns_to_take</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exceptColumns</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">missing_cols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">columns_to_take</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">missing_cols_notification</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Columns </span><span class="si">{</span><span class="n">missing_cols</span><span class="si">}</span><span class="s2"> were specified but are not present in data frame. &quot;</span> \
                               <span class="sa">f</span><span class="s2">&quot;verifyColumnNames was set to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">verifyColumnNames</span><span class="si">}</span><span class="s2">; &quot;</span> \
                               <span class="sa">f</span><span class="s2">&quot;available columns: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verifyColumnNames</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">missing_cols_notification</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">missing_cols_notification</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="n">columns_to_take</span><span class="p">]</span>

<div class="viewcode-block" id="FeatureGeneratorTakeColumns.info"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGeneratorTakeColumns.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;exceptColumns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exceptColumns</span>
        <span class="k">return</span> <span class="n">info</span></div></div>


<div class="viewcode-block" id="FeatureGeneratorFlattenColumns"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGeneratorFlattenColumns">[docs]</a><span class="k">class</span> <span class="nc">FeatureGeneratorFlattenColumns</span><span class="p">(</span><span class="n">RuleBasedFeatureGenerator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Instances of this class take columns with vectors and creates a data frame with columns containing entries of</span>
<span class="sd">    these vectors.</span>

<span class="sd">    For example, if columns &quot;vec1&quot;, &quot;vec2&quot; contain vectors of dimensions dim1, dim2, a data frame with dim1+dim2 new columns</span>
<span class="sd">    will be created. It will contain the columns &quot;vec1_&lt;i1&gt;&quot;, &quot;vec2_&lt;i2&gt;&quot; with i1, i2 ranging in (0, dim1), (0, dim2).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">categorical_feature_names</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
                 <span class="n">normalisation_rules</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">Rule</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
                 <span class="n">normalisation_rule_template</span><span class="p">:</span> <span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">RuleTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param columns: name of the column or list of names of columns to be flattened. If None, all columns will be flattened.</span>
<span class="sd">        :param categorical_feature_names:</span>
<span class="sd">        :param normalisation_rules:</span>
<span class="sd">        :param normalisation_rule_template:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">categorical_feature_names</span><span class="o">=</span><span class="n">categorical_feature_names</span><span class="p">,</span> <span class="n">normalisation_rules</span><span class="o">=</span><span class="n">normalisation_rules</span><span class="p">,</span>
            <span class="n">normalisation_rule_template</span><span class="o">=</span><span class="n">normalisation_rule_template</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">columns</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>

    <span class="k">def</span> <span class="nf">_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">columns_to_flatten</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns_to_flatten</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Flattening column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># NOTE: we found the use of np.stack to produce the most runtime-efficient results.</span>
            <span class="c1"># Other variants, e.g. based on lists instead of numpy.arrays, perform much worse.</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2"> was expected to contain one dimensional vectors, something went wrong&quot;</span><span class="p">)</span>
            <span class="n">dimension</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">new_columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span><span class="p">)]</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Flattening resulted in </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">new_columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> new columns&quot;</span><span class="p">)</span>
            <span class="n">result_df</span><span class="p">[</span><span class="n">new_columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result_df</span>

<div class="viewcode-block" id="FeatureGeneratorFlattenColumns.info"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGeneratorFlattenColumns.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">return</span> <span class="n">info</span></div></div>


<div class="viewcode-block" id="FeatureGeneratorFromColumnGenerator"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGeneratorFromColumnGenerator">[docs]</a><span class="k">class</span> <span class="nc">FeatureGeneratorFromColumnGenerator</span><span class="p">(</span><span class="n">RuleBasedFeatureGenerator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implements a feature generator via a column generator</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="vm">__qualname__</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_gen</span><span class="p">:</span> <span class="s1">&#39;ColumnGenerator&#39;</span><span class="p">,</span> <span class="n">take_input_column_if_present</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_categorical</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">normalisation_rule_template</span><span class="p">:</span> <span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">RuleTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param column_gen: the underlying column generator</span>
<span class="sd">        :param take_input_column_if_present: if True, then if a column whose name corresponds to the column to generate exists</span>
<span class="sd">            in the input data, simply copy it to generate the output (without using the column generator); if False, always</span>
<span class="sd">            apply the columnGen to generate the output</span>
<span class="sd">        :param is_categorical: whether the resulting column is categorical</span>
<span class="sd">        :param normalisation_rule_template: template for a DFTNormalisation for the resulting column.</span>
<span class="sd">            This should only be provided if is_categorical is False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">is_categorical</span> <span class="ow">and</span> <span class="n">normalisation_rule_template</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;normalisationRuleTemplate should be None when the generated column is categorical&quot;</span><span class="p">)</span>

        <span class="n">categorical_feature_names</span> <span class="o">=</span> <span class="p">(</span><span class="n">column_gen</span><span class="o">.</span><span class="n">generatedColumnName</span><span class="p">,)</span> <span class="k">if</span> <span class="n">is_categorical</span> <span class="k">else</span> <span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">categorical_feature_names</span><span class="o">=</span><span class="n">categorical_feature_names</span><span class="p">,</span> <span class="n">normalisation_rule_template</span><span class="o">=</span><span class="n">normalisation_rule_template</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">takeInputColumnIfPresent</span> <span class="o">=</span> <span class="n">take_input_column_if_present</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columnGen</span> <span class="o">=</span> <span class="n">column_gen</span>

<div class="viewcode-block" id="FeatureGeneratorFromColumnGenerator.info"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGeneratorFromColumnGenerator.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;takeInputColumnIfPresent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">takeInputColumnIfPresent</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;generatedColName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnGen</span><span class="o">.</span><span class="n">generatedColumnName</span>
        <span class="k">return</span> <span class="n">info</span></div>

    <span class="k">def</span> <span class="nf">_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">col_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnGen</span><span class="o">.</span><span class="n">generatedColumnName</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">takeInputColumnIfPresent</span> <span class="ow">and</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Taking column &#39;</span><span class="si">{</span><span class="n">col_name</span><span class="si">}</span><span class="s2">&#39; from input data frame&quot;</span><span class="p">)</span>
            <span class="n">series</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating column &#39;</span><span class="si">{</span><span class="n">col_name</span><span class="si">}</span><span class="s2">&#39; via </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">columnGen</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">series</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columnGen</span><span class="o">.</span><span class="n">generate_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">col_name</span><span class="p">:</span> <span class="n">series</span><span class="p">})</span></div>


<div class="viewcode-block" id="ChainedFeatureGenerator"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.ChainedFeatureGenerator">[docs]</a><span class="k">class</span> <span class="nc">ChainedFeatureGenerator</span><span class="p">(</span><span class="n">FeatureGenerator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Chains feature generators such that they are executed one after another. The output of generator i&gt;=1 is the input of</span>
<span class="sd">    generator i+1 in the generator sequence.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">feature_generators</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">FeatureGenerator</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">FeatureGenerator</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param feature_generators: feature generators to apply in order; the properties of the last feature generator</span>
<span class="sd">            determine the relevant meta-data such as categorical feature names and normalisation rules</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featureGenerators</span> <span class="o">=</span> <span class="n">flatten_arguments</span><span class="p">(</span><span class="n">feature_generators</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_generators</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Empty list of feature generators&quot;</span><span class="p">)</span>
        <span class="n">last_fg</span><span class="p">:</span> <span class="n">FeatureGenerator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureGenerators</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">categorical_feature_names</span><span class="o">=</span><span class="n">last_fg</span><span class="o">.</span><span class="n">get_categorical_feature_name_regex</span><span class="p">(),</span> <span class="n">normalisation_rules</span><span class="o">=</span><span class="n">last_fg</span><span class="o">.</span><span class="n">get_normalisation_rules</span><span class="p">(),</span>
            <span class="n">add_categorical_default_rules</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">featureGen</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureGenerators</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">featureGen</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_generate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>

<div class="viewcode-block" id="ChainedFeatureGenerator.is_fitted"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.ChainedFeatureGenerator.is_fitted">[docs]</a>    <span class="k">def</span> <span class="nf">is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="n">fg</span><span class="o">.</span><span class="n">is_fitted</span><span class="p">()</span> <span class="k">for</span> <span class="n">fg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureGenerators</span><span class="p">])</span></div>

<div class="viewcode-block" id="ChainedFeatureGenerator.info"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.ChainedFeatureGenerator.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;chainedFeatureGeneratorNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_names</span><span class="p">()</span></div>

<div class="viewcode-block" id="ChainedFeatureGenerator.fit_generate"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.ChainedFeatureGenerator.fit_generate">[docs]</a>    <span class="k">def</span> <span class="nf">fit_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fitting and generating features with </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">featureGenerators</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">fg</span><span class="o">.</span><span class="n">fit_generate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span></div></div>


<div class="viewcode-block" id="FeatureGeneratorTargetDistribution"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGeneratorTargetDistribution">[docs]</a><span class="k">class</span> <span class="nc">FeatureGeneratorTargetDistribution</span><span class="p">(</span><span class="n">FeatureGenerator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A feature generator, which, for a column T (typically the categorical target column of a classification problem</span>
<span class="sd">    or the continuous target column of a regression problem),</span>

<span class="sd">    * can ensure that T takes on limited set of values t_1, ..., t_n by allowing the user to apply</span>
<span class="sd">      binning using given bin boundaries</span>
<span class="sd">    * computes for each value c of a categorical column C the conditional empirical distribution</span>
<span class="sd">      P(T | C=c) in the training data during the training phase,</span>
<span class="sd">    * generates, for each requested column C and value c in the column, n features</span>
<span class="sd">      &#39;&lt;C&gt;_&lt;T&gt;_distribution_&lt;t_i&gt;&#39; = P(T=t_i | C=c) if flatten=True</span>
<span class="sd">      or one feature &#39;&lt;C&gt;_&lt;T&gt;_distribution&#39; = [P(T=t_i | C=c), ..., P(T=t_n | C=c)] if flatten=False</span>

<span class="sd">    Being probability values, the features generated by this feature generator are already normalised.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">columns</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
            <span class="n">target_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">target_column_bins</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">int</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">IntervalIndex</span><span class="p">]],</span>
            <span class="n">target_column_in_features_df</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">flatten</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param columns: the categorical columns for which to generate distribution features</span>
<span class="sd">        :param target_column: the column the distributions over which will make up the features.</span>
<span class="sd">            If targetColumnBins is not None, this column will be discretised before computing the conditional distributions</span>
<span class="sd">        :param target_column_bins: if not None, specifies the binning to apply via pandas.cut</span>
<span class="sd">            (see https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.cut.html).</span>
<span class="sd">            Note that if a value should match no bin, NaN will generated. To avoid this when specifying bin boundaries in a list,</span>
<span class="sd">            -inf and +inf should be used as the first and last entries.</span>
<span class="sd">        :param target_column_in_features_df: if True, when fitting will look for targetColumn in the features data frame (X) instead of in</span>
<span class="sd">            target data frame (Y)</span>
<span class="sd">        :param flatten: whether to generate a separate scalar feature per distribution value rather than one feature</span>
<span class="sd">            with all of the distribution&#39;s values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span> <span class="o">=</span> <span class="n">flatten</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">columns</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targetColumn</span> <span class="o">=</span> <span class="n">target_column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targetColumnInFeaturesDf</span> <span class="o">=</span> <span class="n">target_column_in_features_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targetColumnBins</span> <span class="o">=</span> <span class="n">target_column_bins</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">:</span>
            <span class="n">normalisation_rule_template</span> <span class="o">=</span> <span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">RuleTemplate</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">normalisation_rule_template</span> <span class="o">=</span> <span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">RuleTemplate</span><span class="p">(</span><span class="n">unsupported</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">normalisation_rule_template</span><span class="o">=</span><span class="n">normalisation_rule_template</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_targetColumnValues</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># This will hold the mapping: column -&gt; featureValue -&gt; targetValue -&gt; targetValueEmpiricalProbability</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_discreteTargetDistributionsByColumn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="FeatureGeneratorTargetDistribution.info"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGeneratorTargetDistribution.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;targetColumn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetColumn</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;targetColumnBins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetColumnBins</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;flatten&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span>
        <span class="k">return</span> <span class="n">info</span></div>

    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This will persist the empirical target probability distributions for all unique values in the specified columns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetColumnInFeaturesDf</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">targetColumn</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">targetColumn</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetColumnBins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">discretised_target</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetColumnBins</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">discretised_target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_targetColumnValues</span> <span class="o">=</span> <span class="n">discretised_target</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_discreteTargetDistributionsByColumn</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_discreteTargetDistributionsByColumn</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">column_target_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="n">column_target_df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
            <span class="n">column_target_df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">discretised_target</span><span class="o">.</span><span class="n">values</span>
            <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">valueTargetsDf</span> <span class="ow">in</span> <span class="n">column_target_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">column</span><span class="p">):</span>
                <span class="c1"># The normalized value_counts contain targetValue -&gt; targetValueEmpiricalProbability for the current value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_discreteTargetDistributionsByColumn</span><span class="p">[</span><span class="n">column</span><span class="p">][</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">valueTargetsDf</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discreteTargetDistributionsByColumn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Feature generator has not been fitted&quot;</span><span class="p">)</span>
        <span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">target_distribution_by_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discreteTargetDistributionsByColumn</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">target_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_targetColumnValues</span><span class="p">:</span>
                    <span class="c1"># Important: pd.Series.apply should not be used here, as it would label the resulting column as categorical</span>
                    <span class="n">result_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">targetColumn</span><span class="si">}</span><span class="s2">_distribution_</span><span class="si">{</span><span class="n">target_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="p">[</span><span class="n">target_distribution_by_value</span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">target_value</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">distributions</span> <span class="o">=</span> <span class="p">[[</span><span class="n">target_distribution_by_value</span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">targetValue</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">targetValue</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_targetColumnValues</span><span class="p">]</span>
                                 <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]]</span>
                <span class="n">result_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">targetColumn</span><span class="si">}</span><span class="s2">_distribution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">distributions</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result_df</span></div>


<div class="viewcode-block" id="FeatureGeneratorFromVectorModel"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGeneratorFromVectorModel">[docs]</a><span class="k">class</span> <span class="nc">FeatureGeneratorFromVectorModel</span><span class="p">(</span><span class="n">FeatureGenerator</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">vector_model</span><span class="p">:</span> <span class="s2">&quot;VectorModel&quot;</span><span class="p">,</span>
            <span class="n">target_feature_generator</span><span class="p">:</span> <span class="n">FeatureGenerator</span><span class="p">,</span>
            <span class="n">categorical_feature_names</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">normalisation_rules</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">Rule</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">normalisation_rule_template</span><span class="p">:</span> <span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">RuleTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">input_feature_generator</span><span class="p">:</span> <span class="n">FeatureGenerator</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">use_target_feature_generator_for_training</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides a feature via predictions of a given model</span>

<span class="sd">        :param vector_model: model used for generate features from predictions</span>
<span class="sd">        :param target_feature_generator: generator for target to be predicted</span>
<span class="sd">        :param categorical_feature_names:</span>
<span class="sd">        :param normalisation_rules:</span>
<span class="sd">        :param normalisation_rule_template:</span>
<span class="sd">        :param input_feature_generator: optional feature generator to be applied to input of vectorModel&#39;s fit and predict</span>
<span class="sd">        :param use_target_feature_generator_for_training: if False, this generator will always apply the model</span>
<span class="sd">            to generate features.</span>
<span class="sd">            If True, this generator will use targetFeatureGenerator to generate features, bypassing the</span>
<span class="sd">            model. This is useful for the case where the model which is</span>
<span class="sd">            to receive the generated features shall be trained on the original targets rather than the predictions</span>
<span class="sd">            thereof.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">categorical_feature_names</span><span class="o">=</span><span class="n">categorical_feature_names</span><span class="p">,</span> <span class="n">normalisation_rules</span><span class="o">=</span><span class="n">normalisation_rules</span><span class="p">,</span>
            <span class="n">normalisation_rule_template</span><span class="o">=</span><span class="n">normalisation_rule_template</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">useTargetFeatureGeneratorForTraining</span> <span class="o">=</span> <span class="n">use_target_feature_generator_for_training</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targetFeatureGenerator</span> <span class="o">=</span> <span class="n">target_feature_generator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputFeatureGenerator</span> <span class="o">=</span> <span class="n">input_feature_generator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">useTargetFeatureGeneratorForTraining</span> <span class="o">=</span> <span class="n">use_target_feature_generator_for_training</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vectorModel</span> <span class="o">=</span> <span class="n">vector_model</span>

    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">target_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetFeatureGenerator</span><span class="o">.</span><span class="n">fit_generate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputFeatureGenerator</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputFeatureGenerator</span><span class="o">.</span><span class="n">fit_generate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vectorModel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">target_df</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputFeatureGenerator</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputFeatureGenerator</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">useTargetFeatureGeneratorForTraining</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ctx</span><span class="o">.</span><span class="n">is_fitted</span><span class="p">():</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using targetFeatureGenerator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">targetFeatureGenerator</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> to generate target features&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetFeatureGenerator</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating target features via </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vectorModel</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vectorModel</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<div class="viewcode-block" id="FeatureGeneratorFromVectorModel.info"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGeneratorFromVectorModel.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;wrappedModel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vectorModel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">info</span></div></div>


<div class="viewcode-block" id="FeatureGeneratorMapColumn"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGeneratorMapColumn">[docs]</a><span class="k">class</span> <span class="nc">FeatureGeneratorMapColumn</span><span class="p">(</span><span class="n">RuleBasedFeatureGenerator</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a single feature from a single input column by applying a function to each element of the input column</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">input_col_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">feature_col_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">categorical_feature_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">normalisation_rules</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">Rule</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">normalisation_rule_template</span><span class="p">:</span> <span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">RuleTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">add_categorical_default_rules</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">categorical_feature_names</span><span class="o">=</span><span class="n">categorical_feature_names</span><span class="p">,</span> <span class="n">normalisation_rules</span><span class="o">=</span><span class="n">normalisation_rules</span><span class="p">,</span>
            <span class="n">normalisation_rule_template</span><span class="o">=</span><span class="n">normalisation_rule_template</span><span class="p">,</span> <span class="n">add_categorical_default_rules</span><span class="o">=</span><span class="n">add_categorical_default_rules</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inputColName</span> <span class="o">=</span> <span class="n">input_col_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_featureColName</span> <span class="o">=</span> <span class="n">feature_col_name</span>

    <span class="k">def</span> <span class="nf">_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputColName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputColName</span><span class="si">}</span><span class="s2">&#39; required by feature generator not found in list of columns: &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">input_series</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputColName</span><span class="p">]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">input_series</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_create_value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">_featureColName</span><span class="p">:</span> <span class="n">values</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_create_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Maps a value from the input column to a feature value</span>

<span class="sd">        :param value: a value from the input column</span>
<span class="sd">        :return: the feature value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="FeatureGeneratorMapColumnDict"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGeneratorMapColumnDict">[docs]</a><span class="k">class</span> <span class="nc">FeatureGeneratorMapColumnDict</span><span class="p">(</span><span class="n">RuleBasedFeatureGenerator</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an arbitrary number of features from a single input column by applying a function to each element of the input column</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_col_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">categorical_feature_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">normalisation_rules</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">Rule</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">normalisation_rule_template</span><span class="p">:</span> <span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">RuleTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">add_categorical_default_rules</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">categorical_feature_names</span><span class="o">=</span><span class="n">categorical_feature_names</span><span class="p">,</span> <span class="n">normalisation_rules</span><span class="o">=</span><span class="n">normalisation_rules</span><span class="p">,</span>
            <span class="n">normalisation_rule_template</span><span class="o">=</span><span class="n">normalisation_rule_template</span><span class="p">,</span> <span class="n">add_categorical_default_rules</span><span class="o">=</span><span class="n">add_categorical_default_rules</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inputColName</span> <span class="o">=</span> <span class="n">input_col_name</span>

    <span class="k">def</span> <span class="nf">_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputColName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputColName</span><span class="si">}</span><span class="s2">&#39; required by feature generator not found in list of columns: &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">input_series</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputColName</span><span class="p">]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_create_features_dict</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">input_series</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_create_features_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Maps a value from the input column to a dictionary containing one or more features.</span>

<span class="sd">        :param value: a value from the input column</span>
<span class="sd">        :return: a dictionary mapping feature names to values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="FeatureGeneratorNAMarker"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGeneratorNAMarker">[docs]</a><span class="k">class</span> <span class="nc">FeatureGeneratorNAMarker</span><span class="p">(</span><span class="n">RuleBasedFeatureGenerator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates features indicating whether another feature is N/A (not available).</span>
<span class="sd">    It can be practical to use this feature generator in conjunction with DFTFillNA for models that cannot handle missing values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">value_a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">value_na</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Note: When changing the default values used, use only values that are considered to be normalised when using this</span>
<span class="sd">        feature generation in a context where DFTNormalisation is used (no normalisation is applied to features generated</span>
<span class="sd">        by this feature generator).</span>

<span class="sd">        :param columns: the columns for which to generate</span>
<span class="sd">        :param value_a: the feature value if the input feature is available</span>
<span class="sd">        :param value_na: the feature value if the input feature is not available</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">normalisation_rule_template</span><span class="o">=</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">RuleTemplate</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valueA</span> <span class="o">=</span> <span class="n">value_a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valueNA</span> <span class="o">=</span> <span class="n">value_na</span>

    <span class="k">def</span> <span class="nf">_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="n">new_cols</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">value_map</span> <span class="o">=</span> <span class="p">{</span><span class="kc">True</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">valueNA</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">valueA</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">new_cols</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">_na&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value_map</span><span class="p">[</span><span class="n">isNA</span><span class="p">]</span> <span class="k">for</span> <span class="n">isNA</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_cols</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span></div>


<div class="viewcode-block" id="flattened_feature_generator"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.flattened_feature_generator">[docs]</a><span class="k">def</span> <span class="nf">flattened_feature_generator</span><span class="p">(</span><span class="n">fgen</span><span class="p">:</span> <span class="n">FeatureGenerator</span><span class="p">,</span> <span class="n">columns_to_flatten</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">keep_other_columns</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">normalisation_rules</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">Rule</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
        <span class="n">normalisation_rule_template</span><span class="p">:</span> <span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">RuleTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a flattening version of the input feature generator.</span>

<span class="sd">    :param fgen: the feature generator which generates columns that are to be flattened</span>
<span class="sd">    :param columns_to_flatten: list of names of output columns to be flattened; if None, flatten all columns</span>
<span class="sd">    :param keep_other_columns: whether any additional columns that are not to be flattened are to be retained</span>
<span class="sd">        by the returned feature generator</span>
<span class="sd">    :param normalisation_rules: additional normalisation rules for the flattened output columns</span>
<span class="sd">    :param normalisation_rule_template: This parameter can be supplied instead of normalisation_rules for the case where</span>
<span class="sd">        there shall be a single rule that applies to all flattened output columns</span>
<span class="sd">    :return: FeatureGenerator instance that will generate flattened versions of the specified columns and leave</span>
<span class="sd">        all other output columns as is.</span>
<span class="sd">    </span>
<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from sensai.featuregen import FeatureGeneratorTakeColumns, flattened_feature_generator</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; df = pd.DataFrame({&quot;foo&quot;: [[1, 2], [3, 4]], &quot;bar&quot;: [&quot;a&quot;, &quot;b&quot;]})</span>
<span class="sd">        &gt;&gt;&gt; fgen = flattened_feature_generator(FeatureGeneratorTakeColumns(), columns_to_flatten=[&quot;foo&quot;])</span>
<span class="sd">        &gt;&gt;&gt; fgen.generate(df)</span>
<span class="sd">           foo_0  foo_1 bar</span>
<span class="sd">        0      1      2   a</span>
<span class="sd">        1      3      4   b</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">flattening_generator</span> <span class="o">=</span> <span class="n">FeatureGeneratorFlattenColumns</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns_to_flatten</span><span class="p">,</span> <span class="n">normalisation_rules</span><span class="o">=</span><span class="n">normalisation_rules</span><span class="p">,</span>
        <span class="n">normalisation_rule_template</span><span class="o">=</span><span class="n">normalisation_rule_template</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">columns_to_flatten</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">keep_other_columns</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ChainedFeatureGenerator</span><span class="p">(</span><span class="n">fgen</span><span class="p">,</span> <span class="n">flattening_generator</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ChainedFeatureGenerator</span><span class="p">(</span><span class="n">fgen</span><span class="p">,</span>
            <span class="n">MultiFeatureGenerator</span><span class="p">(</span><span class="n">flattening_generator</span><span class="p">,</span> <span class="n">FeatureGeneratorTakeColumns</span><span class="p">(</span><span class="n">except_columns</span><span class="o">=</span><span class="n">columns_to_flatten</span><span class="p">)))</span></div>


<div class="viewcode-block" id="FeatureGeneratorFromDFT"><a class="viewcode-back" href="../../../sensai/featuregen/feature_generator.html#sensai.featuregen.feature_generator.FeatureGeneratorFromDFT">[docs]</a><span class="k">class</span> <span class="nc">FeatureGeneratorFromDFT</span><span class="p">(</span><span class="n">FeatureGenerator</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dft</span><span class="p">:</span> <span class="n">DataFrameTransformer</span><span class="p">,</span> <span class="n">categorical_feature_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">normalisation_rules</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">Rule</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">normalisation_rule_template</span><span class="p">:</span> <span class="n">data_transformation</span><span class="o">.</span><span class="n">DFTNormalisation</span><span class="o">.</span><span class="n">RuleTemplate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">add_categorical_default_rules</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">categorical_feature_names</span><span class="o">=</span><span class="n">categorical_feature_names</span><span class="p">,</span> <span class="n">normalisation_rules</span><span class="o">=</span><span class="n">normalisation_rules</span><span class="p">,</span>
            <span class="n">normalisation_rule_template</span><span class="o">=</span><span class="n">normalisation_rule_template</span><span class="p">,</span> <span class="n">add_categorical_default_rules</span><span class="o">=</span><span class="n">add_categorical_default_rules</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dft</span> <span class="o">=</span> <span class="n">dft</span>

    <span class="k">def</span> <span class="nf">_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dft</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dft</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></div>
</pre></div>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By sensAI contributors
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2019-2024 by sensAI contributors.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>